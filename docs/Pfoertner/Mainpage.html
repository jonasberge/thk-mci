<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Porter Mainpage</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
    <link rel="stylesheet" href="../styles.css">
  </head>
  <body>

<!--hero---------------------------------------------------------------------------------->
  <section class="hero mx-0">
    <div class="hero-image">
      <div class="hero-text">
        <h1 class="title is-1 has-text-white mx-4 my-2">
          TH-Köln
        </h1>
        <h2 class="subtitle is-2 has-text-white mx-4 my-2">
          Campus Gummersbach
        </h2>
        <!-- Main container -->
        <nav class="level">
          <!-- Left side -->
          <div class="level-left">
          </div>
          <!-- Right side -->
          <div class="level-right mr-4 mb-2">
            <div class="level-item">
              <div class="field has-addons">
                <p class="control">
                  <input class="input" type="text" placeholder="Suche">
                </p>
                <p class="control">
                  <button class="button">
                    Suchen
                  </button>
                </p>
              </div>
          </div>
        </nav>
      </div>
    </div>
  </section>


<!--nav----------------------------------------------------------------------------------->
  <!--nav class="navbar is-primary">
    <div class="container">
      <div class="navbar-brand">
        <a class="navbar-item" href="#" style="font-weight: bold;">
          Trans.ponder
        </a>
        <span class="navbar-burger burger" data-target="navMenu">
          <span></span>
          <span></span>
          <span></span>
        </span>
      </div>
      <div id="navMenu" class="navbar-menu">
        <div class="navbar-end">
          <a href="#" class="navbar-item is-activ">Home</a>
          <a href="#" class="navbar-item">Verleih</a>
          <a href="#" class="navbar-item">Rückgabe</a>
          <a href="#" class="navbar-item">Verliehene</a>
          <a href="#" class="navbar-item">Suche</a>
        </div>
      </div>
    </div>
  </nav>
  <script type="text/javascript">
    (function(){
      var burger = document.querySelector('.burger');
      var nav = document.querySelector('#'+burger.dataset.target);

      burger.addEventListener('click', function(){
        burger.classList.toggle('is-active');
        nav.classList.toggle('is-active');
      });
    })();
  </script-->

<!--sidemenu------------------------------------------------------------------------------>
<div class="columns is-fullheight">
  <div class="column is-2 is-sidebar-menu is-hidden-mobile is-fullheight">
    <aside class="menu">
      <hr class="navbar-divider">
      <p class="menu-label">
        Dashboard
      </p>
      <hr class="navbar-divider">
      <ul class="menu-list">
        <li><a class="is-active">Dashboard</a></li>
        <li id="btn_trans_verleih"><a>Verleih</a></li>
        <li id="btn_trans_rückgabe"><a>Rückgabe</a></li>
        <li><a class="has-text-grey">Verliehene Transponder
        </a></li>
      </ul>
      <div>
        <hr class="navbar-divider">
        <p class="menu-label">
          Sonstige
        </p>
        <hr class="navbar-divider">
        <ul class="menu-list">
          <li><a class="has-text-grey">Einstellung</a></li>
          <li><a href="./Login.html">Logout</a></li>
        </ul>
      </div>

    </aside>
  </div>

<!--Modal-scheme------------------------------------------
  <section>
    <div>
      <button class="button is-link is-large" id="button-modal">Link</button>

      <div class="modal" id="page-modal">
        <div class="modal-background"></div>
        <div class="modal-content">
          Hier ist ein PopUp
        </div>
        <button class="modal-close is-large" aria-label="close" id="button-close"></button>
      </div>
    </div>
    <script type="text/javascript">
      var button_modal = document.getElementById('button-modal')
      var modal = document.getElementById('page-modal')
      var button_close = document.getElementById('button-close')

      button_modal.onclick = function(){
        modal.style.display = 'block';
      }
      button_close.onclick = function(){
        modal.style.display = 'none'
      }
    </script>
  </section>
-->


    <!--Transponder zurückgeben------------------>
  <section>
    <div>
      <div class="modal pt-6" id="mdl_trans_rückgabe">
        <div class="modal-background"></div>
        <div class="modal-content mt-6">
          <article class="message is-large is-link">
            <div class="message-header">
              <p>Transponder zurückgeben</p>
            </div>
            <div class="message-body">
              <section class="container">
                <div class="level ">
                  <p class="level-item"><input class="input is-clipped" type="text" placeholder="Transpondernummer eingeben..."></p>
                  <p class="level-item"><button class="button is-link" id="btn_trans_rückgabe_prüfen">Prüfen</button></p>
                </div>
                <br>
                <div class="level">
                  <div class="level-item">
                    <p>Raum:<br>Ausleiher:<br>Ausleihdatum:<br>Uhrzeit:<br>Fristgerecht:</p>
                  </div>
                  <div class="level-item">
                    <p>0.401<br>Alex Brimm:<br>TT.MM.YYYY:<br>HH:MM Uhr<br>Ja</p>
                  </div>
                </div>
                <br>
                <div class="level" id="btn_close_trans_rückgabe">
                  <button class="button is-link is-outlined ">Abbrechen</button>
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  <button class="button is-link level-item">Rückgabe Bestätigen</button>
                </div>
              </section>
            </div>
          </article>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      //Modal itself
      var button_modal_transponder_rückgabe = document.getElementById('btn_trans_rückgabe')
      var modal_transponder_rückgabe = document.getElementById('mdl_trans_rückgabe')
      var button_close_transponder_rückgabe = document.getElementById('btn_close_trans_rückgabe')
      var button_transponder_check = document.getElementById('btn_trans_rückgabe_prüfen')

      button_modal_transponder_rückgabe.onclick = function(){
        modal_transponder_rückgabe.style.display = 'block';
      }
      button_close_transponder_rückgabe.onclick = function(){
        modal_transponder_rückgabe.style.display = 'none';
      }
      button_transponder_check.onclick = function(){

      }
    </script>
  </section>

  <!--Transponder verleihen-------------------->
  <section>
    <div>
      <div class="modal pt-6" id="mdl_trans_verleih">
        <div class="modal-background"></div>
        <div class="modal-content mt-6">
          <article class="message is-large is-link">
            <div class="message-header">
              <p>Transponder verleihen</p>
            </div>
            <div class="message-body">
              <section class="container">
                <div class="section py-0">
                  Geben Sie eine Raumnummer ein und wählen Sie einen Transponder.<br><br>Raum: <input class="input" placeholder="0.000"><br>
                </div>
                <section class="section pb-0 pt-4">
                  <div class="columns">
                    <div class="column is-three-fifth">
                      <div class="control">
                        <div class="select">
                          <select>
                            <option>Transponder wählen...</option>
                            <option>Transponder 1</option>
                            <option>Transponder 2</option>
                            <option>Transponder 3</option>
                            <option>Transponder 4</option>
                            <option>Transponder 5</option>
                          </select>
                        </div>
                      </div>
                    </div>

                    <div class="column is-two-fifth">
                      <div class="level">
                        <button class="button is-link level-item">MultiCa prüfen</button>
                      </div>
                    </div>
                  </div>

                  <section class="section py-0 px-0">
                    <div class="level">
                      <button class="button is-link level-item">Unterschrift einlesen</button>
                    </div>
                    <div class="level">
                      <div class="left-level"></div>
                      <div class="right-level">
                        <section class="section level-item pb-0 pr-0" id="btn_close_trans_verleih">
                          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                          <button class="button is-link is-outlined is-medium">Abbrechen</button>
                          &nbsp;
                          <button class="button is-link is-medium">Bestätigen</button>
                        </section>
                      </div>
                    </div>
                  </section>
                </section>
              </section>
            </div>
          </article>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      //Modal itself
      var button_modal_transponder_verleih = document.getElementById('btn_trans_verleih')
      var modal_transponder_verleih = document.getElementById('mdl_trans_verleih')
      var button_close_transponder_verleih = document.getElementById('btn_close_trans_verleih')

      button_modal_transponder_verleih.onclick = function(){
        modal_transponder_verleih.style.display = 'block';
      }
      button_close_transponder_verleih.onclick = function(){
        modal_transponder_verleih.style.display = 'none';
      }
    </script>
  </section>


  <!--table------------------------------------------------------------------------------>
  <div class="column" >
    <div class="table-container">
      <table id="table-transponder" class="table is-hoverable is-fullwidth">
        <thead class="is-primary">
          <tr>
            <td>Raum</td><td>Dozent</td><td>Transponderliste</td><td>Dauer</td><td>Status</td><td>Icon</td>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>



<script src="../vendor/sql-js/sql-wasm.js"></script>
<script src="../assets/scripts/util.js"></script>
<script src="../assets/scripts/db.js"></script>
<script src="../assets/scripts/queries.js"></script>
<script>

// populate the table above.
(function () {

  const table = document.querySelector('#table-transponder');

  const create_td_with = function (value) {
    const td = document.createElement('td');
    td.innerText = value;
    return td;
  };

  const formatSeconds = function (s) {
    result = '';
    if (!s)
      return result;

    t = secondsToTime(s);

    if (t.h > 0)
      result += t.h + ' Stunde' + (t.h == 1 ? '' : 'n');

    if (t.m > 0) {
      if (t.h > 0)
        result += ' und';
      result += ' ' + t.m + ' Minute' + (t.m == 1 ? '' : 'n');
    }

    return result;
  }

  query_transponders().then(function (result) {
    tds = [];

    for (room of result) {
      const rental_time = formatSeconds(room.diff_seconds);

      const tr = document.createElement('tr');
      const items = {
        room_name: room.room_name,
        responsible_professor: room.responsible_professor,
        transponder_list: room.transponder_list,
        rental_time: rental_time,
        is_rented: room.is_rented ? 'Rot' : 'Grün',
        icon: '<icon>'
      }

      for (key in items) {
        if (items.hasOwnProperty(key)) {
          const td = document.createElement('td');
          td.innerText = items[key];
          tr.appendChild(td);
          if (key == 'rental_time') {
            td.dataset.seconds = room.diff_seconds;
            tds.push(td);
          }
        }
      }

      table.appendChild(tr);
    }

    const timeout_seconds = 1;
    const timeout_function = function () {
      for (td of tds) {
        seconds = parseInt(td.dataset.seconds) + timeout_seconds;
        td.innerText = formatSeconds(seconds);
        td.dataset.seconds = seconds;
      }
    };

    (function create_timeout() {
      setTimeout(function () {
        timeout_function();
        create_timeout();
      }, timeout_seconds * 1000);
    })();

  });

})();

</script>
